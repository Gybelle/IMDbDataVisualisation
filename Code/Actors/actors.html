<!-- Examples: https://github.com/d3/d3/wiki/Gallery -->
<html>
	<head>
		<title>Actors and their movies</title>
		<meta charset="UTF-8">

		<!-- Bootstrap -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<!-- Optional Bootstrap theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

		<style>
			body {
				padding: 20px;
			}

			.box {
				padding: 10px;
			}

			.box div {
				padding: 10px;
			}

			div.map-visualisation {
				background-color: blue; 
				height: 600px;
				border: solid black 2px;
			}

			div.search-box {
				background-color: #F2F2F2;
				height: 600px;
				border: solid black 2px;
			}

			div.search-box div#custom-search-input {
				height: 30%;
			}

			div.search-box div#filter-results {
				height: 70%;
				overflow: scroll;
			}


			div.acting-ages {
				background-color: #F2F2F2;
				height: 200px;
				border: solid black 2px;
			}

			div.acting-ages div#female-images {
				width: 100%;
				display: inline-block;
				
				text-align: justify;
				line-height: 0;

			}

			div.acting-ages img.age-image,
			div.acting-ages div.legend {
				display: inline-block;
				vertical-align: middle;
			}


			div.acting-ages div#female-images:after {
				content: "";
				width: 100%;
				display: inline-block;
				vertical-align: bottom;
			}

			div.information-panel {
				background-color: #F2F2F2;
				height: 200px;
				border: solid black 2px;
			}

			div.information-panel h3.male {
				color: blue;
			}

			div.information-panel h3.female {
				color: #FF69B4;
			}

			div.spoken-languages {
				background-color: #F2F2F2;
				height: 200px;
				border: solid black 2px;
			}

		</style>


	</head>
	<body>
    	<h1>IMDb: Actors and their movies</h1>

    	<div class="row">
    		<!-- map visualisation -->
	    	<div class="col-md-8 box">
		    	<div class="map-visualisation">
		    		<p>Map</p>
		    		<a target="_blank" style="color: cyan" href="https://bost.ocks.org/mike/leaflet/">A nice library to display interactive maps combined with D3.js</a>
		    	</div>
	    	</div>
	    	<!-- end map visualisation -->

			<!-- search box -->
	    	<div class="col-md-4 box">
		    	<div class="search-box">

		            <div id="custom-search-input">
		    			<p>Search box</p>
		                <div class="btn-group" role="group" aria-label="...">
						  <button type="button" class="btn btn-default">Actors</button>
						  <button type="button" class="btn btn-default">Movies</button>
						</div>
		                <div class="input-group col-md-12">
		                    <input type="text" class="form-control input-lg" placeholder="Search..." id="custom-search-input-field"/>
		                    <span class="input-group-btn">
		                        <button class="btn btn-info btn-lg" type="button">
		                            <i class="glyphicon glyphicon-search"></i>
		                        </button>
		                    </span>
		                </div>
		            </div>

		            <div id="filter-results">
		            	

		            </div>

		    	</div>
	    	</div>
	    	<!-- end search box -->
    	</div> <!-- end row -->


    	<div class="row">
    		<!-- Information -->
	    	<div class="col-md-2 box">
		    	<div class="information-panel">
		    		<h3><span class="first-name">Jane</span> <span class="last-name">Doe</span></h3>
		    		<p class="birth-location">Los Angeles</p>
		    		<p><span class="birth-year">1947</span> <span class="death-year">- 2014</span></p>
		    	</div>
	    	</div>
	    	<!-- end information -->

			<!-- acting ages -->
	    	<div class="col-md-7 box">
		    	<div class="acting-ages">
		    		<h3>Acting ages</h3>
		    		
		    		<div id="female-images">
	    				0
		    			<img class="age-image female range-0 saturate" src="img/girl_1.png" />
		    			3
		    			<img class="age-image female range-1" src="img/girl_2.png" />
		    			6
		    			<img class="age-image female range-2" src="img/girl_3.png" />
		    			12
		    			<img class="age-image female range-3" src="img/girl_4.png" />
		    			18
		    			<img class="age-image female range-4" src="img/girl_5.png" />
		    			30
		    			<img class="age-image female range-5" src="img/girl_6.png" />
		    			60
		    			<img class="age-image female range-6" src="img/girl_7.png" />
		    			67
			    		<div class="legend">
			    			<p>
			    				24 movies
			    			</p>
			    			<p>
			    				12 movies
			    			</p>
			    			<p>
			    				0 movies
			    			</p>
			    		</div>

		    		</div>
		    	</div>
	    	</div>
	    	<!-- end acting ages -->

			<!-- spoken languages -->
	    	<div class="col-md-3 box">
		    	<div class="spoken-languages">
		    		<p>Spoken Languages</p>
		    	</div>
	    	</div>
	    	<!-- end spoken languages -->

    	</div> <!-- end row -->




  	</body>

	
	<!-- JQuery -->
	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<!-- Bootstrap-->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<!-- D3.js -->
	<script src="https://d3js.org/d3.v4.min.js"></script>

	<!-- Custom JS -->
	<script>

	/**
	 * CODE TO LOAD THE DATA
	 */
	var actors = [];
	var movies = [];
	var actorsInMovies = [];

	d3.csv("data/actors.csv", function(data) {
	  data.forEach(function(d) {
	    d.ActorID = +d.ActorID;
		d.BirthYear = +d.BirthYear;
	    d.DeathYear = +d.DeathYear;
	    //d.FirstName = d.FirstName.toLowerCase();
	    //d.LastName = d.LastName.toLowerCase();
	  });
	  actors = data;

    	onFilter();

	});

	d3.csv("data/movies.csv", function(data) {
	  data.forEach(function(d) {
	    d.ID = +d.ID;
		d.Year = +d.Year;
	    d.EndYear = +d.EndYear;
	  });
	  movies = data;
	});

	d3.csv("data/actorsInMovies.csv", function(data) {
		data.forEach(function(d) {
			d.ActorID = +d.ActorID;
			d.MovieOrSeriesID = +d.MovieOrSeriesID;
			d.isMovie = +d.isMovie;
		})
		actorsInMovies = data;
	})

	/**
	 * SEARCH RELATED CODE
	 */
    
    d3.select('#custom-search-input-field').on('keyup', onFilter);
    
    function onFilter(){
      var filterText = d3.select('#custom-search-input-field').property('value');
      
      filteredData = actors; //todo: change this based on selected type(s)

      if (filterText !== ""){
        var filteredData = filteredData.filter(function(d){
        	var returnValue = 
        		   d.FirstName.toLowerCase().indexOf(filterText.toLowerCase()) === 0
        		|| d.LastName.toLowerCase().indexOf(filterText.toLowerCase()) === 0;
          return (returnValue);
        });
      }
      
      d3.select('#filter-results').html(
        filteredData.map(function(d){
        	var returnValue = "" +
        		"<a class=\"selectActor\" href=\"#\" data-actorid=\"" + d.ActorID + "\"  >" +
        		d.FirstName + " " + d.LastName +
        		"</a>";

          return returnValue;
        }).join("<br/>")
      );
      
    }


    /**
     * CODE TO SELECT AN ACTOR
     */

    // When selecting an actor:
	$(document.body).on('click', '.selectActor' ,function(){
		//is this possible in D3?
		var actorID = $(this).data("actorid");

		var filtered = actors.filter(function(d){
		    return (d.ActorID === actorID);
        });

		if (filtered.length === 0)
			return;

		var actor = filtered[0];
		updatePersonalInformation(actor);
		updateActingAges(actor);
		updateSpokenLanguages(actor);
		updateMap(actor);
	});

	function updatePersonalInformation(actor) {
		var $name = $('.information-panel > h3');
		var $firstName = $('.information-panel > h3 > span.first-name');
		var $lastName = $('.information-panel > h3 > span.last-name');
		var $birthLocation = $('.information-panel > p.birth-location');
		var $birthYear = $('.information-panel > p > span.birth-year');
		var $deathYear = $('.information-panel > p > span.death-year');

		//Example of how to handle male/female
		if (actor.IsMale === "True") {
			$name.addClass('male');
			$name.removeClass('female');
		} else {
			$name.addClass('female');
			$name.removeClass('male');
		}

		$firstName.html(actor.FirstName);
		$lastName.html(actor.LastName);
		
		if (actor.BirthLocation.trim() === "") {
			$birthLocation.html("<i>Location of birth unknown</i>")
		} else {
			$birthLocation.html(actor.BirthLocation);
		}

		if (actor.BirthYear > 0) {
			$birthYear.html(actor.BirthYear);
			if (actor.DeathYear > 0) {
				$deathYear.html("- " + actor.DeathYear);
			} else {
				$deathYear.html("");
			}
		} else {
			$birthYear.html("<i>Date of birth unknown</i>");
			$deathYear.html("");
		}
	}

	function updateActingAges(actor) {
		var actorID = actor.ActorID;
		var ranges = [0,0,0,0,0,0,0];
		var actorBirthYear = actor.BirthYear;

		if (actorBirthYear == 0 || actorBirthYear === undefined ) {
			console.log("No birthyear available, calculating acting ages is impossible.");
			return;
		}

		//calculate the occurences for each age range
		var movieIDsForActor = actorsInMovies.filter(function(d){
		    return (d.ActorID === actorID);
        });

        for (var i = 0; i < movieIDsForActor.length; i++) {
        	var movieID = movieIDsForActor[i].MovieOrSeriesID;
	        var movie = movies.filter(function(d){
			    return (d.ID === movieID);
	        })[0];
	        var age = movie.Year - actorBirthYear;

	        if (age >= 0 && age < 3) {
	        	ranges[0] = ranges[0] + 1;
	        } else if (age >= 3 && age < 6) {
	        	ranges[1]++;
	        } else if (age >= 6 && age < 12) {
	        	ranges[2]++;
	        } else if (age >= 12 && age < 18) {
	        	ranges[3]++;
	        } else if (age >= 18 && age < 30) {
	        	ranges[4]++;
	        } else if (age >= 30 && age < 60) {
	        	ranges[5]++;
	        } else if (age >= 60 && age < 67) {
	        	ranges[6]++;
	        }
        }


        //Now update the images 
        //todo? maybe use a SVG to draw the image, and manipulate color there
	}

	function updateSpokenLanguages(actor) {
		
	}

	function updateMap(actor) {

	}

	</script>
</html>